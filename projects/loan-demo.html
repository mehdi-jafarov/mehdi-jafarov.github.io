<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, user-scalable=no">
  <title>Try It Yourself - Mehdi Jafarov</title>

  <!-- Style Links -->
  <!-- <link rel="stylesheet" href="../css/styles.min.css"> -->
  <link rel="stylesheet" href="../css/styles.css">
  <link rel="shortcut icon" href="../img/favicon.svg" type="image/x-icon">

  <!-- Onnx Runtime Link -->
  <script src="https://cdn.jsdelivr.net/npm/onnxruntime-web/dist/ort.min.js"></script>
</head>
<body>
  <nav class="navbar">
    <div class="nav-links">
      <ul>
        <li><a href="https://mehdi-jafarov.github.io/#">Home</a></li>
        <li><a href="https://mehdi-jafarov.github.io/#projects">Work</a></li>
        <li><a href="https://mehdi-jafarov.github.io/#contact">Contact</a></li>
      </ul>
    </div>
    <div class="nav-action">
      <a class="button" href="https://github.com/mehdi-jafarov/SBA-Default-Risk-Prediction.git" target="_blank">
        GitHub Repo
      </a>
    </div>
  </nav>
<main role="main">
  <h1>Try It Yourself</h1>

  <section id="about-container">
    <div id="about">
      <p>
        This model is a simplified demonstration, not a production-level system. It was built for practice and to showcase predictive analytics. In this case, the model tends to favor loans secured by real estate, as historical SBA data suggested such loans carried lower risk. The goal here is to highlight the process of building and applying a predictive model, rather than to provide final, deployable decisions.
      </p>
    </div>

    <form id="prediction-form" class="card">
      <input id="loanAmt" type="number" placeholder="Loan Amount Requested" step="0.01">
      <input id="sbaPortion" type="number" placeholder="SBA Guaranteed Portion" step="0.01">
      <select style="cursor: pointer;" id="realEstate">
        <option value="">Industry</option>
        <option value="1">Real Estate</option>
        <option value="0">Other</option>
      </select>
      <button class="button" type="submit">Predict</button>
      <span class="status" id="status">Status</span>
    </form>
  </section>
</main>

<footer>
  <hr>
  <p style="font-size: 0.85em; color: #777;">Â© 2025 Mehdi Jafarov</p>
</footer>

<script>
const form = document.getElementById("prediction-form");
const statusEl = document.getElementById("status");
let session;

// Load ONNX model
(async () => {
  try {
    session = await ort.InferenceSession.create("../models/sba-sk-logreg.onnx");
    console.log("ONNX model loaded");
  } catch (err) {
    console.error("Failed to load ONNX model:", err);
    statusEl.innerText = "Load Failed";
  }
})();

form.addEventListener("submit", async (e) => {
  e.preventDefault();

  // Parse input numbers and remove any $ or commas
  const loanAmt = parseFloat(document.getElementById("loanAmt").value.replace(/[$,]/g,""));
  const sbaPortion = parseFloat(document.getElementById("sbaPortion").value.replace(/[$,]/g,""));
  const realEstate = parseInt(document.getElementById("realEstate").value);

  if (isNaN(loanAmt) || isNaN(sbaPortion) || ![0,1].includes(realEstate) || loanAmt === 0) {
    statusEl.innerText = "Invalid Values";
    return;
  }

  // Compute Portion and recession
  const portion = sbaPortion / loanAmt;
  const recession = 0.0;

  // DEBUG: log inputs
  console.log("=== DEBUG INPUTS ===");
  console.log("Loan Amount:", loanAmt);
  console.log("SBA Portion:", sbaPortion);
  console.log("RealEstate:", realEstate);
  console.log("Portion:", portion);
  console.log("Recession:", recession);

  // Prepare input tensor
  const feeds = {
    float_input: new ort.Tensor("float32", Float32Array.from([realEstate, portion, recession]), [1,3])
  };

  try {
    const results = await session.run(feeds);
    const outputKey = Object.keys(results)[0];
    const label = Number(results[outputKey].data[0]); // Read class label directly
    console.log("Predicted class label:", label);

    // Only show Approved or Denied
    statusEl.innerText = label === 0 ? "Approved" : "Denied";
  } catch (err) {
    console.error("ONNX inference error:", err);
    statusEl.innerText = "Inference failed";
  }
});
</script>
</body>
</html>
